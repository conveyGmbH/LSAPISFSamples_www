<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test SalesforceLeadLib - Complete Module</title>

    <!-- Tailwind CSS (required) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome (required) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #container {
            width: 100vw;
            height: 100vh;
        }

        /* Test controls overlay */
        .test-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 15px 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 100000;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .test-controls button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .test-controls .btn-test {
            background: #3b82f6;
            color: white;
        }

        .test-controls .btn-test:hover {
            background: #2563eb;
        }

        .test-controls .btn-clear {
            background: #ef4444;
            color: white;
        }

        .test-controls .btn-clear:hover {
            background: #dc2626;
        }

        .test-controls .btn-info {
            background: #10b981;
            color: white;
        }

        .test-controls .btn-info:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <!-- Main Container for the Library -->
    <div id="container"></div>

    <!-- Test Controls -->
    <div class="test-controls">
        <span style="font-weight: 600; color: #3b82f6;">Test Controls:</span>
        <button class="btn-test" onclick="testInitialize()">
            <i class="fas fa-play"></i> Initialize Module
        </button>
        <button class="btn-info" onclick="testLoadLead()">
            <i class="fas fa-user"></i> Load Sample Lead
        </button>
        <button class="btn-clear" onclick="testClear()">
            <i class="fas fa-trash"></i> Clear
        </button>
        <button class="btn-info" onclick="showConsole()">
            <i class="fas fa-terminal"></i> Show Console
        </button>
    </div>

    <!-- Include the Library -->
    <script src="salesforceLeadLib-complete.js"></script>

    <script>
        // Sample lead data for testing
        const sampleLeadData = {
            FirstName: 'John',
            LastName: 'Doe',
            Company: 'Acme Corporation',
            Email: 'john.doe@acme.com',
            Phone: '+1 555-0123',
            Title: 'Marketing Director',
            Website: 'https://acme.com',
            Street: '123 Main Street',
            City: 'New York',
            State: 'NY',
            PostalCode: '10001',
            Country: 'USA',
            Description: 'Interested in our enterprise solution',
            LeadSource: 'Website',
            Status: 'Open - Not Contacted',
            Rating: 'Hot',
            Industry: 'Technology',
            NumberOfEmployees: 500,
            AnnualRevenue: 5000000,
            Question01: 'What is your budget?',
            Answers01: '$50,000 - $100,000',
            Question02: 'When do you plan to implement?',
            Answers02: 'Q2 2025',
            KontaktViewId: 'TEST_12345',
            EventId: '67890'
        };

        // Global library instance
        let sfLib = null;

        /**
         * Test 1: Initialize the module with complete interface
         */
        function testInitialize() {
            console.log('ðŸ§ª TEST: Initialize Module');

            const container = document.getElementById('container');

            // Create library instance
            sfLib = new SalesforceLeadLib({
                backendUrl: 'http://localhost:3000',
                serverName: 'lstest.convey.de',
                apiName: 'apisftest'
            });

            console.log('âœ… Library instance created:', sfLib);

            // Build the complete interface
            try {
                sfLib.buildCompleteInterface(container);
                console.log('âœ… Interface built successfully!');
                console.log('ðŸ“‹ Check the UI - you should see:');
                console.log('   - Sidebar with logo, navigation, API status');
                console.log('   - Main content with header, stats cards, field controls');
                console.log('   - Empty state (no lead loaded yet)');

                alert('âœ… Module initialized!\n\nInterface is ready. Now click "Load Sample Lead" to populate with data.');
            } catch (error) {
                console.error('âŒ Error building interface:', error);
                alert('âŒ Error: ' + error.message);
            }
        }

        /**
         * Test 2: Load a sample lead
         */
        async function testLoadLead() {
            console.log('ðŸ§ª TEST: Load Sample Lead');

            if (!sfLib) {
                alert('âš ï¸ Please initialize the module first!');
                return;
            }

            const container = document.getElementById('container');

            try {
                // Load lead data
                await sfLib.loadLead(container, sampleLeadData, sampleLeadData.EventId);

                console.log('âœ… Lead loaded successfully!');
                console.log('ðŸ“‹ Lead data:', sampleLeadData);
                console.log('ðŸ“‹ Check the UI - you should see:');
                console.log('   - Lead information displayed in table/cards');
                console.log('   - Active/Inactive/Total stats updated');
                console.log('   - Transfer button state updated');

                alert('âœ… Sample lead loaded!\n\nYou should now see the lead data in the table.');
            } catch (error) {
                console.error('âŒ Error loading lead:', error);
                alert('âŒ Error: ' + error.message);
            }
        }

        /**
         * Test 3: Clear the module
         */
        function testClear() {
            console.log('ðŸ§ª TEST: Clear Module');

            if (!sfLib) {
                alert('âš ï¸ Module is not initialized!');
                return;
            }

            const container = document.getElementById('container');

            try {
                sfLib.clear(container);
                sfLib = null;

                console.log('âœ… Module cleared successfully!');
                console.log('ðŸ“‹ Container is now empty');

                alert('âœ… Module cleared!\n\nYou can initialize it again if needed.');
            } catch (error) {
                console.error('âŒ Error clearing module:', error);
                alert('âŒ Error: ' + error.message);
            }
        }

        /**
         * Show console helper
         */
        function showConsole() {
            alert('ðŸ“‹ Console Instructions:\n\n' +
                  '1. Press F12 to open Developer Tools\n' +
                  '2. Go to "Console" tab\n' +
                  '3. You will see all test logs and results\n\n' +
                  'Available Tests:\n' +
                  '- Initialize Module: Creates the interface\n' +
                  '- Load Sample Lead: Populates with test data\n' +
                  '- Clear: Removes everything\n\n' +
                  'You can also test manually:\n' +
                  '- Click "Connect to Salesforce"\n' +
                  '- Toggle Active/Inactive fields\n' +
                  '- Switch between List and Card views\n' +
                  '- Edit field values\n' +
                  '- Try to transfer (will show errors if backend not running)');
        }

        /**
         * Advanced test functions (call from console)
         */
        window.testTransfer = async function() {
            console.log('ðŸ§ª TEST: Transfer Lead to Salesforce');

            if (!sfLib) {
                console.error('âŒ Module not initialized');
                return;
            }

            try {
                const result = await sfLib.transferLead(sampleLeadData);
                console.log('âœ… Transfer result:', result);
                return result;
            } catch (error) {
                console.error('âŒ Transfer error:', error);
                throw error;
            }
        };

        window.testConnect = async function() {
            console.log('ðŸ§ª TEST: Connect to Salesforce');

            if (!sfLib) {
                console.error('âŒ Module not initialized');
                return;
            }

            try {
                const result = await sfLib.connect({
                    username: 'test@salesforce.com',
                    password: 'testpassword',
                    orgId: '00D5g000000abcd'
                });
                console.log('âœ… Connection result:', result);
                return result;
            } catch (error) {
                console.error('âŒ Connection error:', error);
                throw error;
            }
        };

        window.testGetStatus = async function(leadId = 'TEST_12345') {
            console.log('ðŸ§ª TEST: Get Lead Status');

            if (!sfLib) {
                console.error('âŒ Module not initialized');
                return;
            }

            try {
                const status = await sfLib.getStatus(leadId);
                console.log('âœ… Status:', status);
                return status;
            } catch (error) {
                console.error('âŒ Status error:', error);
                throw error;
            }
        };

        // Auto-show instructions on load
        window.addEventListener('load', () => {
            console.log('');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('ðŸ“¦ SALESFORCE LEAD LIB - TEST PAGE LOADED');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('');
            console.log('ðŸŽ¯ Quick Start:');
            console.log('   1. Click "Initialize Module" button');
            console.log('   2. Click "Load Sample Lead" button');
            console.log('   3. Explore the interface!');
            console.log('');
            console.log('ðŸ”§ Test Controls (bottom of page):');
            console.log('   - Initialize Module: Creates the complete interface');
            console.log('   - Load Sample Lead: Populates with test data');
            console.log('   - Clear: Removes everything');
            console.log('   - Show Console: Shows this help');
            console.log('');
            console.log('ðŸ§ª Advanced Tests (call from console):');
            console.log('   testTransfer()     - Test lead transfer');
            console.log('   testConnect()      - Test Salesforce connection');
            console.log('   testGetStatus()    - Test status retrieval');
            console.log('');
            console.log('ðŸ“‹ Manual Testing:');
            console.log('   - Click "Connect to Salesforce" (top right)');
            console.log('   - Toggle List/Card views');
            console.log('   - Filter by Active/Inactive/All/Custom');
            console.log('   - Click on fields to edit');
            console.log('   - Toggle field active/inactive status');
            console.log('   - Try to transfer lead');
            console.log('');
            console.log('âš ï¸  Backend Required:');
            console.log('   For full functionality, backend must be running at:');
            console.log('   http://localhost:3000');
            console.log('');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('');

            // Show welcome alert
            setTimeout(() => {
                alert('ðŸ§ª SalesforceLeadLib Test Page\n\n' +
                      'âœ… Library loaded successfully!\n\n' +
                      'Quick Start:\n' +
                      '1. Click "Initialize Module"\n' +
                      '2. Click "Load Sample Lead"\n' +
                      '3. Explore the interface!\n\n' +
                      'Check the console (F12) for detailed logs.');
            }, 500);
        });

        // Global access for debugging
        window.sfLib = sfLib;
        window.sampleLeadData = sampleLeadData;
    </script>
</body>
</html>
